import{d as R,c as i,o as a,F as _,a as t,g as p,i as G,t as v,_ as B,b as E,q as ne,r as A,n as z,T as fe,h as $,x as le,j as h,l as ae,y as pe,z as ke,e as m,u as g,w as C,f as ye,A as _e}from"./index-CizmrxTt.js";import{A as I}from"./AppButton-CjW2r0Ix.js";import{S as K}from"./SpriteAvatar-C0b5jzIa.js";import{u as be}from"./gameStore-DlP5lpfE.js";import{u as we}from"./useAudioEngine-BskwuX2U.js";const Ce={class:"challenge-card"},$e={class:"type"},Me={class:"description"},xe={class:"meta"},Se=R({__name:"ChallengeCard",props:{challenge:{}},setup(c){return(k,e)=>(a(),i("div",Ce,[c.challenge?(a(),i(_,{key:0},[t("p",$e,[p(v(c.challenge.type==="individual"?"INDIVIDUAL":"VERSUS")+" ",1),c.challenge.timerOverrideSeconds?(a(),i(_,{key:0},[p(" · ⏱️ "+v(c.challenge.timerOverrideSeconds)+"s ",1)],64)):G("",!0)]),t("h2",null,v(c.challenge.title),1),t("p",Me,v(c.challenge.description),1),t("ul",xe,[t("li",null,[c.challenge.type==="individual"?(a(),i(_,{key:0},[p("👤 Solo")],64)):(a(),i(_,{key:1},[p("👥 "+v(c.challenge.minPlayers)+"-"+v(c.challenge.maxPlayers),1)],64))])])],64)):(a(),i(_,{key:1},[e[0]||(e[0]=t("h2",null,"Kies “Start spel” om te beginnen",-1)),e[1]||(e[1]=t("p",{class:"description"},"We loten automatisch spelers en een nieuwe challenge.",-1))],64))]))}}),te=B(Se,[["__scopeId","data-v-54a0faeb"]]),Te={class:"dialog"},Ie={class:"grid"},Ve=["onClick"],Pe=["src","alt"],Ae={key:1},ze={class:"actions"},Re=["disabled"],Be=R({__name:"WinnerSelect",props:{players:{},modelValue:{},open:{type:Boolean}},emits:["update:modelValue","confirm","close"],setup(c,{emit:k}){const e=c,d=k,w=r=>(r==null?void 0:r.startsWith("/"))||(r==null?void 0:r.includes("."))||(r==null?void 0:r.startsWith("data:")),y=r=>{e.modelValue.includes(r)?d("update:modelValue",e.modelValue.filter(l=>l!==r)):d("update:modelValue",[...e.modelValue,r])};return(r,u)=>(a(),E(fe,{to:"body"},[c.open?(a(),i("div",{key:0,class:"winner-overlay",onClick:u[2]||(u[2]=ne(l=>d("close"),["self"]))},[t("div",Te,[u[3]||(u[3]=t("h3",null,"Wie heeft gewonnen?",-1)),u[4]||(u[4]=t("p",null,"Kies één of meerdere spelers. Enter = bevestigen.",-1)),t("div",Ie,[(a(!0),i(_,null,A(c.players,l=>(a(),i("button",{key:l.id,type:"button",class:z(["chip",{active:c.modelValue.includes(l.id)}]),onClick:M=>y(l.id)},[t("span",{class:z(["sprite",{image:w(l.sprite)}])},[w(l.sprite)?(a(),i("img",{key:0,src:l.sprite,alt:`Avatar van ${l.name}`,loading:"lazy",decoding:"async"},null,8,Pe)):(a(),i("span",Ae,v(l.sprite),1))],2),t("strong",null,v(l.name),1)],10,Ve))),128))]),t("div",ze,[t("button",{type:"button",class:"ghost",onClick:u[0]||(u[0]=l=>d("close"))},"Annuleren"),t("button",{type:"button",class:"primary",disabled:!c.modelValue.length,onClick:u[1]||(u[1]=l=>d("confirm"))}," Bevestig winnaars ",8,Re)])])])):G("",!0)]))}}),We=B(Be,[["__scopeId","data-v-54ded662"]]),Fe={class:"timer"},De={viewBox:"0 0 100 100"},Ne={class:"value"},Le=44,Oe=R({__name:"TimerRing",props:{duration:{},remaining:{},status:{}},setup(c){const k=c,e=$(()=>k.duration===0?0:Math.max(0,Math.min(1,k.remaining/k.duration))),d=2*Math.PI*Le,w=$(()=>`${d}`),y=$(()=>d*(1-e.value));return(r,u)=>(a(),i("div",Fe,[(a(),i("svg",De,[u[0]||(u[0]=t("circle",{class:"bg",cx:"50",cy:"50",r:"44"},null,-1)),t("circle",{class:"progress",cx:"50",cy:"50",r:"44",style:le({strokeDasharray:w.value,strokeDashoffset:y.value})},null,4)])),t("div",Ne,[t("span",null,v(Math.ceil(Math.max(0,c.remaining)))+"s",1)])]))}}),Ee=B(Oe,[["__scopeId","data-v-e9c81943"]]),Ge={class:"confetti-layer","aria-hidden":"true"},je=R({__name:"ConfettiLayer",props:{trigger:{}},setup(c){const k=c,e=["#ff7998","#ffd25a","#6dd5ff","#c98bff","#9effa0"],d=h([]);let w=0;const y=()=>{d.value=Array.from({length:80},()=>({id:w++,left:Math.random()*100,delay:Math.random()*.3,duration:2+Math.random()*1.5,color:e[Math.floor(Math.random()*e.length)]})),window.setTimeout(()=>{d.value=[]},2500)};return ae(()=>k.trigger,(r,u)=>{r!==u&&r>0&&y()}),(r,u)=>(a(),i("div",Ge,[(a(!0),i(_,null,A(d.value,l=>(a(),i("span",{key:l.id,class:"piece",style:le({left:`${l.left}%`,animationDelay:`${l.delay}s`,animationDuration:`${l.duration}s`,background:l.color})},null,4))),128))]))}}),Ue=B(je,[["__scopeId","data-v-40bf66ff"]]),qe={class:"game"},Ke={class:"score-header"},He={class:"header-actions"},Je={class:"score-grid"},Qe={class:"value"},Xe={class:"modal-card"},Ye={class:"modal-header"},Ze={class:"slots"},et={class:"slot"},tt={key:0,class:"rolling-card"},nt={key:1,class:"placeholder"},lt={key:1,class:"card-wrapper"},at={class:"slot"},st={key:0,class:"preview-avatars"},ot={key:1,class:"participant-tags"},it={key:0,class:"utilities"},rt={class:"timer-block"},ct={class:"status-text"},ut={class:"modal-actions"},dt=R({__name:"GameView",setup(c){const k=ye(),e=be(),d=we(),w=$(()=>e.players),y=$(()=>e.players.filter(s=>s.enabled)),r=$(()=>e.players.filter(s=>e.activePlayerIds.includes(s.id))),u=h(!1),l=h("idle"),M=h(!1),b=h(!1),j=h(null),V=h("Loten..."),x=h([]),W=h(!1),F=h([]),P=h(!1),H=$(()=>{const s=Number(e.currentTimerLimit??e.settings.timerSeconds??0);return Number.isFinite(s)&&s>0?s:60});let S=null,D=null,T=null,N=null;const L=h(null),se=()=>{if(!e.challenges.length)return null;const s=Math.floor(Math.random()*e.challenges.length);return e.challenges[s]},oe=s=>{if(!y.value.length)return[{id:`none-${Math.random()}`,name:"???",sprite:"",color:"#eee",accent:"#fff"}];const n=[...y.value].sort(()=>Math.random()-.5),o=s==="individual"?1:2,O=s==="individual"?1:Math.min(4,n.length);if(O<o)return n.slice(0,O).map(f=>({id:`${f.id}-${Math.random()}`,name:f.name,sprite:f.sprite,color:f.color,accent:f.accent}));const he=Math.min(O,Math.max(o,Math.floor(Math.random()*(O-o+1))+o));return n.slice(0,he).map(f=>({id:`${f.id}-${Math.random()}`,name:f.name,sprite:f.sprite,color:f.color,accent:f.accent}))},J=()=>{j.value=se()},Q=s=>{x.value=oe(s)},U=()=>{S&&(clearInterval(S),S=null),D&&(clearTimeout(D),D=null),T&&(clearInterval(T),T=null),N&&(clearTimeout(N),N=null)},ie=()=>{b.value=!0,l.value="complete",x.value=r.value.map(s=>({id:s.id,name:s.name,sprite:s.sprite,color:s.color,accent:s.accent}))},re=()=>{const s=e.activeChallenge;if(!s){V.value="Geen challenge beschikbaar",x.value=[],M.value=!1,b.value=!1;return}V.value=s.title,M.value=!0,l.value="players",Q(s.type),T=window.setInterval(()=>Q(s.type),140),N=window.setTimeout(()=>{T&&clearInterval(T),T=null,ie()},1400)},X=s=>{if(U(),!y.value.length){V.value="Geen spelers actief";return}l.value="challenge",M.value=!1,b.value=!1,J(),S=window.setInterval(J,120),D=window.setTimeout(()=>{if(S&&clearInterval(S),S=null,s()===!1){V.value="Even wachten voor reroll",x.value=[],l.value="idle";return}re()},1500)},ce=()=>{u.value=!0,x.value=[],X(()=>!!e.rollChallenge())},Y=()=>{U(),u.value=!1,M.value=!1,b.value=!1,l.value="idle",x.value=[]},ue=()=>{l.value==="challenge"||l.value==="players"||e.rerollReady&&X(()=>e.reroll())},de=async()=>{if(!b.value)return;if(e.startOrResumeChallenge())await d.ensureContext();else{const n=H.value;e.setTimerSeconds(n),e.timer.remaining=n}},me=()=>{!b.value||!r.value.length||(F.value=[],W.value=!0)},ve=()=>{e.markWinners(F.value),W.value=!1,d.playWinChord(),Y()},ge=async()=>{P.value=!P.value,await d.ensureContext(),d.setMuted(P.value),P.value||d.startLoop()},Z=()=>{l.value==="challenge"||l.value==="players"||Y()},ee=()=>{e.tickTimer(),L.value=requestAnimationFrame(ee)};pe(()=>{L.value=requestAnimationFrame(ee)}),ke(()=>{L.value&&cancelAnimationFrame(L.value),U()}),ae(()=>e.gamePhase,(s,n)=>{s==="timeup"&&n!=="timeup"&&d.playTimerPing()});const q=$(()=>b.value&&!!e.activeChallenge);return(s,n)=>(a(),i("div",qe,[m(Ue,{trigger:g(e).winnerBurst},null,8,["trigger"]),t("header",Ke,[n[5]||(n[5]=t("div",{class:"title-block"},[t("p",{class:"eyebrow"},"Scorebord"),t("h1",null,"Tijd voor een challenge")],-1)),t("div",He,[m(I,{theme:"ghost",icon:"⬅️",size:"sm",onClick:n[0]||(n[0]=o=>g(k).push("/"))},{default:C(()=>[...n[3]||(n[3]=[p("Menu",-1)])]),_:1}),m(I,{size:"lg",icon:"🎲",disabled:!y.value.length,onClick:ce},{default:C(()=>[...n[4]||(n[4]=[p(" Next challenge ",-1)])]),_:1},8,["disabled"]),m(I,{theme:"ghost",icon:"🎧",size:"sm",onClick:ge},{default:C(()=>[p(v(P.value?"Muziek uit":"Muziek aan"),1)]),_:1})])]),t("section",Je,[(a(!0),i(_,null,A(w.value,o=>(a(),i("div",{key:o.id,class:z(["score-card",{inactive:!o.enabled}])},[m(K,{name:o.name,sprite:o.sprite,color:o.color,accent:o.accent,variant:"hero",disabled:!o.enabled},null,8,["name","sprite","color","accent","disabled"]),n[6]||(n[6]=t("p",{class:"label"},"Score",-1)),t("p",Qe,v(o.score),1)],2))),128))]),m(_e,{name:"fade"},{default:C(()=>[u.value?(a(),i("div",{key:0,class:"challenge-overlay",onClick:ne(Z,["self"])},[t("div",Xe,[t("div",Ye,[n[8]||(n[8]=t("div",null,[t("p",{class:"eyebrow"},"Challenge Flow"),t("h2",null,"Wie doet er mee?")],-1)),m(I,{theme:"ghost",icon:"✖",size:"sm",onClick:Z},{default:C(()=>[...n[7]||(n[7]=[p(" Sluiten ",-1)])]),_:1})]),t("div",Ze,[t("div",et,[n[9]||(n[9]=t("p",{class:"eyebrow"},"Challenge",-1)),t("div",{class:z(["slot-window",{animating:l.value==="challenge"&&!M.value}])},[M.value?(a(),i("div",lt,[m(te,{challenge:g(e).activeChallenge},null,8,["challenge"])])):(a(),i("div",tt,[j.value?(a(),E(te,{key:0,challenge:j.value},null,8,["challenge"])):(a(),i("p",nt,v(V.value),1))]))],2)]),t("div",at,[n[10]||(n[10]=t("p",{class:"eyebrow"},"Spelers",-1)),t("div",{class:z(["slot-window participants",{animating:l.value==="players"&&!b.value}])},[b.value?(a(),i("div",ot,[(a(!0),i(_,null,A(r.value,o=>(a(),E(K,{key:o.id,name:o.name,sprite:o.sprite,color:o.color,accent:o.accent,variant:"hero"},null,8,["name","sprite","color","accent"]))),128))])):(a(),i("div",st,[(a(!0),i(_,null,A(x.value,o=>(a(),E(K,{key:o.id,name:o.name,sprite:o.sprite,color:o.color,accent:o.accent,variant:"hero"},null,8,["name","sprite","color","accent"]))),128))]))],2)])]),q.value?(a(),i("div",it,[t("div",rt,[m(Ee,{duration:H.value,remaining:g(e).timer.remaining,status:g(e).gamePhase},null,8,["duration","remaining","status"]),m(I,{size:"sm",icon:"⏱️",disabled:!q.value||g(e).timer.running,onClick:de},{default:C(()=>[...n[11]||(n[11]=[p(" Start timer ",-1)])]),_:1},8,["disabled"])]),t("p",ct,v(g(e).gamePhase==="running"?"Timer loopt...":g(e).gamePhase==="timeup"?"Tijd voorbij":"Klaar om te spelen"),1)])):G("",!0),t("div",ut,[m(I,{theme:"ghost",icon:"🔁",disabled:l.value==="challenge"||l.value==="players"||g(e).timer.running||!g(e).rerollReady,onClick:ue},{default:C(()=>[...n[12]||(n[12]=[p(" Reroll ",-1)])]),_:1},8,["disabled"]),m(I,{theme:"danger",icon:"🏅",disabled:!q.value||g(e).gamePhase!=="running"&&g(e).gamePhase!=="timeup",onClick:me},{default:C(()=>[...n[13]||(n[13]=[p(" Markeer winnaar ",-1)])]),_:1},8,["disabled"])])])])):G("",!0)]),_:1}),m(We,{players:r.value,modelValue:F.value,"onUpdate:modelValue":n[1]||(n[1]=o=>F.value=o),open:W.value,onConfirm:ve,onClose:n[2]||(n[2]=o=>W.value=!1)},null,8,["players","modelValue","open"])]))}}),pt=B(dt,[["__scopeId","data-v-9f022a68"]]);export{pt as default};
